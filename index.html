<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Sklad Flight Board</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d0e12;
            --card-bg: #1a1c23;
            --text-main: #ffffff;
            --text-dim: #8b9bb4;
            --accent-green: #00ff9d;
            --accent-yellow: #ffcc00;
            --accent-red: #ff4757;
            --accent-blue: #2d98da;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden; /* –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            display: grid;
            grid-template-rows: 80px 1fr; /* –®–∞–ø–∫–∞ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç */
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- –®–ê–ü–ö–ê --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #2c303a;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .header-title { font-size: 32px; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; color: var(--text-dim); }
        .clock { font-family: 'JetBrains Mono', monospace; font-size: 48px; font-weight: 700; color: var(--text-main); }
        .date { font-size: 20px; color: var(--text-dim); text-align: right; }

        /* --- –°–ï–¢–ö–ê –ö–û–ù–¢–ï–ù–¢–ê --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1.2fr; /* –õ–µ–≤–∞—è —á–∞—Å—Ç—å —á—É—Ç—å —É–∂–µ –ø—Ä–∞–≤–æ–π */
            grid-template-rows: 1fr 1.5fr; /* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –≤–µ—Ä—Ö (–°–ª–µ–¥—É—é—â–∏–π) –∏ –Ω–∏–∑ (–°–ø–∏—Å–æ–∫) */
            gap: 20px;
            height: 100%;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border: 1px solid #333;
        }

        /* --- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨: –û–ë–©–ò–ô –°–¢–ê–¢–£–° (–ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é –≤—ã—Å–æ—Ç—É —Å–ª–µ–≤–∞) --- */
        .status-panel {
            grid-row: 1 / 3; /* –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ */
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .progress-circle { width: 320px; height: 320px; position: relative; margin-bottom: 40px; }
        svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        circle { fill: none; stroke-width: 25; stroke-linecap: round; }
        .bg-circle { stroke: #2c303a; }
        .fg-circle { stroke: var(--accent-green); transition: stroke-dashoffset 1.5s ease; filter: drop-shadow(0 0 15px rgba(0,255,157,0.4)); }
        
        .percent-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; font-weight: 900; }
        .count-text { font-size: 36px; color: var(--text-dim); margin-bottom: 30px; }
        
        .main-status-badge {
            background: #2d3436;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 40px;
            font-weight: 700;
            color: var(--accent-yellow);
            border: 2px solid #444;
            display: inline-block;
        }

        /* --- –ü–†–ê–í–ê–Ø –í–ï–†–•–ù–Ø–Ø: –°–õ–ï–î–£–Æ–©–ò–ô --- */
        .next-panel {
            grid-column: 2;
            justify-content: center;
        }
        .panel-label { color: var(--text-dim); font-size: 20px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .next-id { font-size: 55px; font-weight: 900; color: #fff; font-family: 'JetBrains Mono', monospace; margin-bottom: 10px;}
        .next-info { font-size: 28px; display: flex; align-items: center; gap: 15px; }
        .warning-text { color: var(--accent-red); font-weight: bold; animation: pulse 2s infinite; }
        .arrival-text { color: var(--accent-blue); }

        /* --- –ü–†–ê–í–ê–Ø –ù–ò–ñ–ù–Ø–Ø: –ê–ö–¢–ò–í–ù–´–ï (–°–ü–ò–°–û–ö) --- */
        .active-panel {
            grid-column: 2;
            background: #15171d; /* –ß—É—Ç—å —Ç–µ–º–Ω–µ–µ */
            border: 1px solid #444;
        }
        .active-list-container {
            flex: 1;
            overflow: hidden; /* –°–∫—Ä—ã–≤–∞–µ–º –≤—ã–ª–µ–∑–∞—é—â–∏–π —Ç–µ–∫—Å—Ç */
            position: relative;
        }
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏, –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –¥–ª–∏–Ω–Ω—ã–π */
        .scrolling-content {
            position: absolute;
            width: 100%;
            /* animation: scrollUp 20s linear infinite; - –í–∫–ª—é—á–∏–º —ç—Ç–æ —á–µ—Ä–µ–∑ JS –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */ 
        }

        .list-item {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            padding: 15px 0;
            border-bottom: 1px solid #333;
            color: #ddd;
            display: flex;
            align-items: center;
        }
        .list-item:first-child { border-top: 1px solid #333; }
        .icon { margin-right: 15px; font-size: 28px; }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        @keyframes scrollUp { 
            0% { transform: translateY(0); } 
            15% { transform: translateY(0); } /* –ü–∞—É–∑–∞ –≤ –Ω–∞—á–∞–ª–µ */
            100% { transform: translateY(-100%); } 
        }

    </style>
</head>
<body>

    <div class="header">
        <div class="header-title">–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ö–õ–ê–î–û–ú</div>
        <div style="text-align: right;">
            <div class="clock" id="clock">00:00</div>
            <div class="date" id="date">-- ---</div>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="card status-panel">
            <div class="progress-circle">
                <svg viewBox="0 0 350 350">
                    <circle cx="175" cy="175" r="150" class="bg-circle" />
                    <circle cx="175" cy="175" r="150" class="fg-circle" id="main-circle" stroke-dasharray="942" stroke-dashoffset="942" />
                </svg>
                <div class="percent-text" id="percent">0%</div>
            </div>
            <div class="count-text" id="count-text">-- –∏–∑ --</div>
            <div class="main-status-badge" id="main-status">–ó–ê–ì–†–£–ó–ö–ê</div>
        </div>

        <div class="card next-panel">
            <div class="panel-label">–°–ª–µ–¥—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä</div>
            <div class="next-id" id="next-id">‚Äî</div>
            <div class="next-info" id="next-info">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
        </div>

        <div class="card active-panel">
            <div class="panel-label" style="color: var(--accent-green);">üöö –ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–≥—Ä—É–∑–∫–∏</div>
            <div class="active-list-container" id="list-mask">
                <div class="scrolling-content" id="active-list">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // --- –ß–ê–°–´ ---
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
            document.getElementById('date').innerText = now.toLocaleDateString('ru-RU', {weekday: 'long', day: 'numeric', month: 'long'});
        }, 1000);

        // --- –î–ê–ù–ù–´–ï ---
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS0kYp4Zp2m9jmTRMTZoamaEUBfZg95n3YN_7f0YByCva_978_452f538CXgKhzveg-etToheOTaVCJ/pub?gid=1855124971&single=true&output=csv';

        async function updateData() {
            try {
                const response = await fetch(csvUrl + '&t=' + Date.now());
                const text = await response.text();
                
                // –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–µ—Ä CSV (—É—á–∏—Ç—ã–≤–∞–µ–º, —á—Ç–æ Google –º–æ–∂–µ—Ç –±—Ä–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤ –∫–∞–≤—ã—á–∫–∏)
                // –†–µ–∂–µ–º –ø–æ –ø–µ—Ä–µ–≤–æ–¥—É —Å—Ç—Ä–æ–∫–∏, –Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ
                const rows = text.split('\n').map(row => {
                    // –û—á–µ–Ω—å –≥—Ä—É–±–æ: –±–µ—Ä–µ–º –≤—Å—ë, —á—Ç–æ –º–µ–∂–¥—É –ø–µ—Ä–≤–æ–π –∏ –≤—Ç–æ—Ä–æ–π –∑–∞–ø—è—Ç–æ–π (—è—á–µ–π–∫–∞ B)
                    // CSV —Ñ–æ—Ä–º–∞—Ç: A1, B1, C1...
                    // –ù–∞–º –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å 1 (Column B)
                    let parts = row.split(','); 
                    // –ï—Å–ª–∏ –∑–∞–ø—è—Ç—ã–µ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—Å—Ç–∞, –ª–æ–≥–∏–∫–∞ —Å–ª–æ–∂–Ω–µ–µ, –Ω–æ –¥–ª—è –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã B –æ–±—ã—á–Ω–æ –≤ –Ω–∞—á–∞–ª–µ
                    // –ë–µ—Ä–µ–º –≤—Ç–æ—Ä—É—é —è—á–µ–π–∫—É (B) –∏ —á–∏—Å—Ç–∏–º –∫–∞–≤—ã—á–∫–∏
                    let cell = parts[1] || "";
                    // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –±—ã–ª–∞ —Ä–∞–∑–±–∏—Ç–∞ –ª–∏—à–Ω–∏–º–∏ –∑–∞–ø—è—Ç—ã–º–∏, —Å–∫–ª–µ–∏–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ (–¥–ª—è B12)
                    if (parts.length > 2 && row.includes('"')) {
                        // –≠—Ç–æ –∫–æ—Å—Ç—ã–ª—å –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä–æ–∫, –Ω–æ –¥–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏ –º–æ–∂–µ—Ç —Ö–≤–∞—Ç–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–ø–ª–∏—Ç–∞
                        // –õ—É—á—à–µ –Ω–∞–π–¥–µ–º B –ø–æ –∏–Ω–¥–µ–∫—Å—É
                    }
                    return cell.replace(/^"|"$/g, '').replace(/""/g, '"'); 
                });

                // --- 1. –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ (B1, B3) ---
                // –Ø—á–µ–π–∫–∞ B1 - –°—Ç–∞—Ç—É—Å (row 0)
                const b1 = rows[0] || ""; 
                const statusText = b1.split('|')[0].trim(); // –ë–µ—Ä–µ–º —Ç–µ–∫—Å—Ç –¥–æ —á–µ—Ä—Ç—ã
                document.getElementById('main-status').innerText = statusText || "–°–í–Ø–ó–¨...";
                
                // –Ø—á–µ–π–∫–∞ B3 - –°—á–µ—Ç—á–∏–∫ (row 2)
                const b3 = rows[2] || "0 –∏–∑ 0";
                document.getElementById('count-text').innerText = b3;
                
                // –ü—Ä–æ—Ü–µ–Ω—Ç—ã
                const nums = b3.match(/\d+/g);
                if (nums && nums.length >= 2) {
                    const done = parseInt(nums[0]);
                    const total = parseInt(nums[1]);
                    const percent = total > 0 ? Math.round((done/total)*100) : 0;
                    
                    document.getElementById('percent').innerText = percent + '%';
                    const offset = 942 - (942 * percent / 100);
                    document.getElementById('main-circle').style.strokeDashoffset = offset;
                    
                    // –¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞
                    const badge = document.getElementById('main-status');
                    if (statusText.includes("–í –†–ê–ë–û–¢–ï")) { badge.style.color = "#00ff9d"; badge.style.borderColor = "#00ff9d"; }
                    else if (statusText.includes("–ü–ê–£–ó–ê")) { badge.style.color = "#aaa"; badge.style.borderColor = "#555"; }
                    else { badge.style.color = "#ffcc00"; badge.style.borderColor = "#ffcc00"; }
                }

                // --- 2. –°–õ–ï–î–£–Æ–©–ò–ô (B6, B7, B8, R7) ---
                // B7 (row 6) - ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                const nextID = (rows[6] || "‚Äî").trim();
                document.getElementById('next-id').innerText = nextID;

                // B8 (row 7) - –ò–Ω—Ñ–æ –æ–± –æ–ø–æ–∑–¥–∞–Ω–∏–∏
                const delayInfo = (rows[7] || "").trim();
                const infoDiv = document.getElementById('next-info');
                
                if (delayInfo.includes("–û–ü–û–ó–î–ê–ù–ò–ï")) {
                    infoDiv.innerHTML = `<span class="warning-text">‚ö†Ô∏è ${delayInfo}</span>`;
                } else if (delayInfo.includes("–ü–†–ò–ë–£–î–ï–¢")) {
                    infoDiv.innerHTML = `<span class="arrival-text">‚è± ${delayInfo}</span>`;
                } else {
                    infoDiv.innerHTML = `<span style="color:#666">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–∏–±—ã—Ç–∏–∏</span>`;
                }

                // --- 3. –ê–ö–¢–ò–í–ù–´–ï (B12) ---
                // B12 (row 11) - –°–ø–∏—Å–æ–∫
                // –í–∞–∂–Ω–æ: –í–∞—à–∞ —Ñ–æ—Ä–º—É–ª–∞ B12 –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —á–µ—Ä–µ–∑ CHAR(10) - —ç—Ç–æ \n
                // –ù–æ CSV –º–æ–∂–µ—Ç "—Å–∫–ª–µ–∏—Ç—å" —ç—Ç–æ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É. –ù–∞–º –Ω—É–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –µ—ë –æ–±—Ä–∞—Ç–Ω–æ.
                
                // –í CSV Google Sheets –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ —è—á–µ–π–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏.
                // –ù–∞–º –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É 11.
                // –í –º–∞—Å—Å–∏–≤–µ rows, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–¥–µ–ª–∞–ª–∏ –ø—Ä–æ—Å—Ç—ã–º split('\n'), —Å—Ç—Ä–æ–∫–∞ —Å –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Ä–∞–∑–æ–±—å–µ—Ç—Å—è –Ω–∞ –∫—É—Å–∫–∏!
                // –≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞.
                
                // –î–ê–í–ê–ô–¢–ï –ü–û–ü–†–û–ë–£–ï–ú –í–ó–Ø–¢–¨ B12 –ò–ù–ê–ß–ï. 
                // –ú—ã –Ω–∞–π–¥–µ–º –∫—É—Å–æ–∫ —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "üöö" –∏–ª–∏ "üì¶" –≤ —Å—ã—Ä–æ–º —Ç–µ–∫—Å—Ç–µ
                
                // –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è B12:
                // –í –≤–∞—à–µ–º CSV B12 - —ç—Ç–æ –æ–≥—Ä–æ–º–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –∫–∞–≤—ã—á–∫–∞—Ö.
                // –ù–∞–π–¥–µ–º –µ—ë –≤ –∏—Å—Ö–æ–¥–Ω–æ–º response.text()
                
                // –û—á–∏—Å—Ç–∫–∞ —Å–ø–∏—Å–∫–∞
                const listEl = document.getElementById('active-list');
                listEl.innerHTML = '';
                
                // –¢–∞–∫ –∫–∞–∫ –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥ B12 —Å–ª–æ–∂–µ–Ω, –¥–∞–≤–∞–π—Ç–µ —Ä–∞—Å–ø–∞—Ä—Å–∏–º —Ç–æ, —á—Ç–æ –ø–æ–ø–∞–ª–æ –≤ –º–∞—Å—Å–∏–≤.
                // –ï—Å–ª–∏ B12 –±—ã–ª —Ä–∞–∑–±–∏—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –º–∞—Å—Å–∏–≤–∞ rows (–∏–∑-–∑–∞ \n), —Å–æ–±–µ—Ä–µ–º –∏—Ö.
                // –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ "üì¶"
                
                let activeItems = [];
                // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –í–°–ï–ú —Å—Ç—Ä–æ–∫–∞–º CSV –∏ –∏—â–µ–º –º–∞—Ä–∫–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
                rows.forEach(r => {
                    if (r.includes('üì¶') && r.includes('‚Ä¢')) {
                        activeItems.push(r.trim());
                    }
                });

                if (activeItems.length === 0) {
                     listEl.innerHTML = '<div class="list-item" style="color:#666">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞–∑–≥—Ä—É–∑–æ–∫</div>';
                } else {
                    activeItems.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'list-item';
                        // –ö—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
                        // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –∫–∞–≤—ã—á–∫–∏
                        let cleanItem = item.replace(/"/g, '').trim();
                        div.innerText = cleanItem;
                        listEl.appendChild(div);
                    });
                }

                // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏: –µ—Å–ª–∏ –≤—ã—Å–æ—Ç–∞ —Å–ø–∏—Å–∫–∞ –±–æ–ª—å—à–µ –≤—ã—Å–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                const containerHeight = document.getElementById('list-mask').clientHeight;
                const contentHeight = listEl.clientHeight;
                
                if (contentHeight > containerHeight) {
                    // –í–∫–ª—é—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                    listEl.style.animation = `scrollUp ${contentHeight / 20}s linear infinite`; // –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–ª–∏–Ω—ã
                    // –î—É–±–ª–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                    listEl.innerHTML += listEl.innerHTML;
                } else {
                    listEl.style.animation = 'none';
                }

            } catch (e) {
                console.error(e);
            }
        }

        setInterval(updateData, 5000);
        updateData();
    </script>
</body>
</html>